[{invert}]
= Docker : Bases

Remise Ã  niveau

== Pourquoi ?

image::docker-logo-monochromatic.png[width=200]

ğŸ¤” Quel est le problÃ¨me ?

== !

image::matrixfromhell.jpg[]

ProblÃ¨me de temps **exponentiel**

== DÃ©jÃ  vu ?

L'IT n'est pas la seule industrie Ã  rÃ©soudre des problÃ¨mes...

image::also-a-matrix-from-hell.png[]

== Solution: Le conteneur intermodal

"Separation of Concerns"

image::blue-shipping-container.png[]

== Comment Ã§a marche ?

"Virtualisation **LÃ©gÃ¨re**"

image::container_vs_vm.jpg[]

== Conteneur != VM

"Separation of concerns": 1 "tÃ¢che" par conteneur

image::vm-and-container.png[]

==  VMs && Conteneurs

Non exclusifs mutuellement

image::cont-vm-not-excl.png[]

== Comment Ã§a marche ?

== ğŸ“ Exercice : Votre premier conteneur

C'est Ã  vous (ouf) !

* Retournez dans Gitpod
* Dans un terminal, tapez la commande suivante :

[source,bash]
----
docker container run hello-world
# Equivalent de l'ancienne commande 'docker run'
----

== ğŸ©» Anatomie

* Un service "Docker Engine" tourne en tÃ¢che de fond et publie une API REST
* La commande `docker run ...` a envoyÃ© une requÃªte `POST` au service
* Le service a tÃ©lÃ©charge une **Image** Docker depuis le registre **DockerHub**,
* Puis a exÃ©cutÃ© un **conteneur** basÃ© sur cette image

== ğŸ“ Exercice : OÃ¹ est mon conteneur ?

C'est Ã  vous !

[source,bash]
----
docker container ls --help
# ...
docker container ls
# ...
docker container ls --all
----

=> ğŸ¤” comment comprenez vous les rÃ©sultats des 2 derniÃ¨res commandes ?

== âœ… Solution : OÃ¹ est mon conteneur ?

Le conteneur est toujours prÃ©sent dans le "Docker Engine" mÃªme en Ã©tant arrÃªtÃ©

[source]
----
CONTAINER ID   IMAGE         COMMAND    CREATED          STATUS                      PORTS     NAMES
109a9cdd3ec8   hello-world   "/hello"   33 seconds ago   Exited (0) 17 seconds ago             festive_faraday
----

* Un conteneur == une commande "conteneurisÃ©e"
** cf. colonne "*COMMAND*"

* Quand la commande s'arrÃªte : le conteneur s'arrÃªte
** cf. code de sortie dans la colonne "*STATUS*"

== ğŸ“ Exercice : Cycle de vie d'un conteneur simple

* Lancez un nouveau conteneur nommÃ© `bonjour`
** ğŸ’¡ `docker container run --help` ou https://docs.docker.com/engine/reference/commandline/container_run/[Documentation en ligne,windows="_blank"]

* Affichez les "logs" du conteneur (==traces d'exÃ©cution Ã©crites sur le stdout + stderr de la commande conteneurisÃ©e)
** ğŸ’¡ `docker container logs  --help` ou https://docs.docker.com/engine/reference/commandline/container_logs/[Documentation en ligne,windows="_blank"]

* Lancez le conteneur avec la commande https://docs.docker.com/engine/reference/commandline/container_start/[`docker container start`,windows="_blank"]
** Regardez le rÃ©sultat dans les logs

* Supprimez le container avec la commande https://docs.docker.com/engine/reference/commandline/container_rm/[`docker container rm`,windows="_blank"]

== âœ… Solution : Cycle de vie d'un conteneur simple

[source,bash]
----
docker container run --name=bonjour hello-world
# Affiche le texte habituel

docker logs bonjour
# Affiche le mÃªme texte : pratique si on a fermÃ© le terminal

docker start bonjour
# N'affiche pas le texte mais l'identifiant unique du conteneur 'bonjour'

docker logs bonjour
# Le texte est affichÃ© 2 fois !

docker container ls --all
# Le conteneur est prÃ©sent
docker container rm bonjour
docker container ls --all
# Le conteneur n'est plus lÃ  : il a Ã©tÃ© supprimÃ© ainsi que ses logs

docker logs bonjour
# Error: No such container: bonjour
----

== ğŸ“ Exercice : conteneur interactif

* Quel distribution Linux est utilisÃ©e dans le terminal Gitpod ?
** ğŸ’¡ Regardez le fichier `/etc/os-release`

* ExÃ©cutez un conteneur interactif basÃ© sur `alpine:3.17` (une distribution Linux ultra-lÃ©gÃ¨re) et regardez le contenu du fichier au mÃªme emplacement
** ğŸ’¡ `docker container run --help`
** ğŸ’¡ Demandez un https://en.wikipedia.org/wiki/TTY[`tty`] Ã  Docker
** ğŸ’¡ Activez le mode interactif

* ExÃ©cutez la mÃªme commande dans un conteneur basÃ© sur la mÃªme image mais en *NON* interactif
** ğŸ’¡ Comment surcharger la commande par dÃ©faut ?

== âœ… Solution : conteneur interactif

[source,bash]
----
$ cat /etc/os-release
# ... Ubuntu ....

$ docker container run --tty --interactive alpine:3.17
/ # cat /etc/os-release
# ... Alpine ...
# Notez que le "prompt" du terminal est diffÃ©rent DANS le conteneur
/ # exit
$ docker container ls --all

$ docker container run alpine:3.17 cat /etc/os-release
# ... Alpine ...
----

== ğŸ“ Exercice : conteneur en tÃ¢che de fond

* ExÃ©cutez un conteneur, basÃ© sur l'image `nginx` en tÃ¢che de fond ("Background"), nommÃ© `webserver-1`
** ğŸ’¡ On parle de processus "dÃ©tachÃ©" (ou bien "dÃ©monisÃ©")
** âš ï¸ Pensez bien Ã  `docker container ls`

* Regardez le contenu du fichier `/etc/os-release` dans ce conteneur
** ğŸ’¡ `docker exec`

* Essayez d'arrÃªter, dÃ©marrer puis redÃ©marrer le conteneur
** âš ï¸ Pensez bien Ã  `docker container ls` Ã  chaque fois
** ğŸ’¡ `stop`, `start`, `restart`

== âœ… Solution : conteneur en tÃ¢che de fond

[source,bash]
----
docker container run --detach --name=webserver-1 nginx
# <ID du conteneur>

docker container ls
docker container ls --all

docker container exec webserver-1 cat /etc/os-release
# ... Debian ...

docker container stop webserver-1
docker container ls
docker container ls --all

docker container start webserver-1
docker container ls
docker container ls --all

docker container start webserver-1
docker container ls
----

== Images Docker

== Fabriquer sa propre image
