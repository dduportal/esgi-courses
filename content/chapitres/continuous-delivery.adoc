[{invert}]
= "Continuous Everything"

== Livraison Continue

Continuous Delivery (CD)

== Pourquoi la Livraison Continue ?

* Diminuer les risque li√©s au d√©ploiement
* Permettre de r√©colter des retours utilisateurs plus souvent
* Rendre l'avancement visible par *tous*

[quote, Mary and Tom Poppendieck]
____
How long would it take to your organization to deploy a change that
involves just one single line of code?
____

== Qu'est ce que la Livraison Continue ?

* Suite logique de l'int√©gration continue:
** Chaque changement est *potentiellement* d√©ployable en production
** Le d√©ploiement peut donc √™tre effectu√© √† *tout* moment

[quote, Martin Fowler]
____
Your team prioritizes keeping the software *deployable* over working on new features
____

[{invert}]
== !

La livraison continue est l'exercice de **mettre √† disposition automatiquement** le produit logiciel pour qu'il soit pr√™t √† √™tre d√©ploy√© √† tout moment.

== Livraison Continue avec GitHub Actions

== Pr√©-requis: ex√©cution conditionnelle des jobs

* Il est possible d‚Äôex√©cuter conditionnellement un job ou un step √† l'aide du mot cl√© `if` (link:https://docs.github.com/en/actions/learn-github-actions/workflow-syntax-for-github-actions#jobsjob_idif[documentation de `if`])

[source,yaml]
----
jobs:
  release:
    # Lance le job release uniquement si la branche est main.
    if: contains('refs/heads/main', github.ref)
    steps:
      # ...
----

== üéì Secret GitHub / DockerHub Token

* Cr√©ez un personal access token dans le DockerHub avec les droits "Read,Write"
** ‚ö†Ô∏è ne partagez pas ce token, ne le mettez PAS dans GitPod, ne l'enregistrez pas sur votre disque dur
** üí° https://docs.docker.com/docker-hub/access-tokens/[Documentation "Manage access tokens",window="_blank"]

* Ins√©rez le token DockerHub comme secret dans votre d√©p√¥t GitHub
** üí° https://docs.github.com/en/actions/security-guides/encrypted-secrets#creating-encrypted-secrets-for-a-repository[Creating encrypted secrets for a repository,window="_blank"]

== üéì Livraison Continue sur le DockerHub

* *But :* Automatiser le d√©ploiement de l'image dans le DockerHub lorsqu'un tag est pouss√©

* Changez votre workflow de CI de fa√ßon √† ce que, sur un push de tag, les t√¢ches suivantes soient effectu√©es :
** Comme avant: Lint, Build, Test de l'image (en affichant le `README`)
** SI c'est un tag, alors il faut pousser (et √©ventuellement reconstruire avec le bon nom) l'image sur le DockerHub

* üí° Utilisez les GitHub Action suivantes :
** https://github.com/marketplace/actions/docker-login[docker-login, window="_blank]
** https://github.com/marketplace/actions/build-and-push-docker-images[build-and-push-docker-images, window="_blank]

== ‚úÖ Livraison Continue sur le DockerHub

[source,bash]
----
include::../code-samples/gh-actions/ci-docker-push-tag.yml[]
----

== D√©ploiement Continu

üá¨üáß Continuous Deployment / "CD"

== Qu'est ce que le D√©ploiement Continu ?

* Version "avanc√©e" de la livraison continue:
** Chaque changement *est* d√©ploy√© en production, de mani√®re *automatique*

== Continuous Delivery versus Deployment

image::continuous-depl-vs-delivery.jpg[caption=Continuous Delivery vs Deployment,width=700]

[.small]
Source : http://blog.crisp.se/2013/02/05/yassalsundman/continuous-delivery-vs-continuous-deployment

== B√©n√©fices du D√©ploiement Continu

* Rends triviales les proc√©dures de mise en production et de rollback
** Encourage √† mettre en production le plus souvent possible
** Encourage √† faire des mises en production incr√©mentales
* Limite les risques d'erreur lors de la mise en production
* Fonctionne de 1 √† 1000 serveurs et plus encore...

== Qu'est ce que "La production" ?

* Un (ou plusieurs) ordinateur ou votre / vos applications sont ex√©cut√©es
* Ce sont l√† o√π vos utilisateurs "utilisent" votre code
** Que ce soit un serveur web pour une application web
** Ou un t√©l√©phone pour une application mobile
* Certaines plateformes sont plus ou moins outill√©es pour la mise en production automatique

== üéì D√©ploiement Continu sur le DockerHub

* *But :* D√©ployer votre image `cowsay` continuellement sur le DockerHub

* Changez votre workflow de CI de fa√ßon √† ce que, sur un push sur la branch `main`, les t√¢ches suivantes soient effectu√©es :
** Comme avant: Lint, Build, Test de l'image (en affichant le `README`)
** SI c'est la branche `main`, alors il faut pousser l'image avec le tag `latest` sur le DockerHub
** Conservez le cas avec les tags

== ‚úÖ D√©ploiement Continu sur le DockerHub

[source,bash]
----
include::../code-samples/gh-actions/ci-docker-push-main.yml[]
----

== Checkpoint üéØ

* La livraison continue et le d√©ploiement continu √©tendent les concepts du CI

* Les 2 sont automatis√©es, mais un √™tre humain est n√©cessaire comme d√©clencheur pour la 1√®re

* Le choix d√©pends des risques et de la "production"

* On a vu comment automatiser le d√©ploiement dans GitHub Actions
** Conditions dans le workflow
** Gestion de secrets
