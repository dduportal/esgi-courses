[{invert}]
= Plus de Git !

aka. Mettre son code en s√©curit√©

== ü§î Une petite histoire

Votre d√©p√¥t est actuellement sur votre ordinateur.

* Que se passe t'il si :
** Votre disque dur tombe en panne ?
** On vous vole votre ordinateur ?
** Vous √©chappez votre tasse de th√© / caf√© sur votre ordinateur ?
** Une m√©t√©orite tombe sur votre bureau et fracasse votre ordinateur ?

[%notitle]
== !

image:crying.gif[width="500"]

[.small]
Test√©, pas approuv√©.

== Comment √©viter √ßa ?

* R√©pliquer votre d√©p√¥t sur une ou plusieurs machines !
* Git est pens√© pour g√©rer ce de probl√®me

== Gestion de version d√©centralis√©e

* Chaque utilisateur maintient une version du d√©p√¥t _local_ qu'il peut changer √† souhait
* Ind√©pendant du commit, ils peuvent "pousser" une version sur un d√©p√¥t **distant**
* Un d√©p√¥t _local_ peut avoir plusieurs d√©p√¥ts **distants**.

== Centralis√© vs D√©centralis√©

image:cvsdcvs.png[width="800"]

[.small]

Source link:https://www.geeksforgeeks.org/centralized-vs-distributed-version-control-which-one-should-we-choose/[Geek for Geeks]

Cela rends la manipulation un peu plus complexe, allons-y pas √† pas :-)

== üéì Consulter l'historique de commits

* Dans votre workspace GitPod,
* positionnez-vous dans le d√©p√¥t `{student_gh_repository_name}`,
* modifiez le fichier `README.md`, puis commitez,
* et enfin, affichez l'historique de commits.

== ‚úÖ Consulter l'historique de commits

[source,bash]
--
cd /workspace/esgi-devops-2013
echo "A new line" >> ./README.md
git add ./README.md
git commit -m "add a new line to the documentation"

# Liste tous les commits pr√©sent sur la branche main.
git log --graph
--

== Associer un d√©p√¥t distant (1/2)

Git permet de manipuler des "remotes"

* Image "distante" (sur un autre ordinateur) de votre d√©p√¥t local.
* Permet de publier et de rapatrier des branches.
* Le serveur maintient sa propre arborescence de commits, tout comme votre d√©p√¥t local.

* Un d√©p√¥t peut poss√©der N remotes.

== Associer un d√©p√¥t distant (2/2)

[source,bash]
--
# Liste les remotes associ√©s a votre d√©p√¥t
git remote -v
# Vous devriez voir l'URL de votre d√©p√¥t en tant que 'origin'

## La commande 'git clone' a effectu√© l'action ci-dessous pour vous :
# git remote add origin https://<URL de votre d√©p√¥t>
--

== Publier une branche dans sur d√©p√¥t distant

Maintenant qu'on a un d√©p√¥t, il faut publier notre code dessus !

[source, bash]
--
# git push <remote> <votre_branche_courante>
git push origin main
--

== Que s'est il pass√© ?

image:remote1.svg[]

== !

* `git` a envoy√© la branche `main` sur le remote `origin`

* ... qui √† accept√© le changement et mis √† jour sa propre branche main.
* `git` a cr√©√© localement une branche distante `origin/main` qui suis l'√©tat de `main` sur le remote.

* Vous pouvez constater que la page github de votre d√©p√¥t affiche le code source

== Refaisons un commit !

[source, bash]
--

git commit --allow-empty -m "Yet another commit"
git push origin main
--

== !

image:remote2.svg[]

== Branche distante

Dans votre d√©p√¥t local, une branche "distante" est automatiquement maintenue par git

C'est une image du dernier √©tat connu de la branche sur le remote.

Pour mettre a jour les branches distantes depuis le remote il faut utiliser :

`git fetch <nom_du_remote>`

== !

[source, bash]
--
# Lister toutes les branches y compris les branches distances
git branch -a


# Notez qu'est list√© remotes/origin/main


# Mets a jour les branches distantes du remote origin
git fetch origin


# Rien ne se passe, votre d√©p√¥t est tout neuf, changeons √ßa!
--

== üéì Cr√©ez un commit depuis GitHub directement

* Cliquez sur le bouton √©diter en haut √† droite du "README"
* Changez le contenu de votre README
* Dans la section "Commit changes"
** Ajoutez un titre de commit et une description

** Cochez "Commit directly to the main branch"
** Validez

GitHub cr√©e directement un commit sur la branche main sur le d√©p√¥t distant

== ‚úÖ Rapatrier les changements distants

[source, bash]
--
# Mets √† jour les branches distantes du d√©p√¥t origin
git fetch origin

# La branche distante main a avanc√© sur le remote origin
# => La branche remotes/origin/main est donc mise a jour

# Ouvrez votre README
code ./README.md

# Myst√®re, le fichier README ne contient pas vos derniers changements?
git log

# Votre nouveau commit n'est pas pr√©sent, AHA !
--

== !

image:remote3.svg[]

== Branche Distante VS Branche Locale

Le changement √† √©t√© rapatri√©, cependant il n'est pas encore pr√©sent sur votre branche main locale

[source, bash]
--
# Merge la branch distante dans la branche locale.
git merge origin/main
--

== !

Vu que votre branche main n'a pas diverg√© (== partage le m√™me historique) de la branche distante, `git merge` effectue automatiquement un "fast forward".

[source, bash]
--
Updating 1919673..b712a8e
Fast-forward
 README.md | 1 +

 1 file changed, 1 insertion(+)
--

Cela signifie qu'il fait "avancer" la branche `main` sur le m√™me commit que la branche `origin/main`

== !

image:remote4.svg[]

== !

[source, bash]
--
# Liste l'historique de commit
git log

# Votre nouveau commit est pr√©sent sur la branche main !
# Juste au dessus de votre commit initial !
--

Et vous devriez voir votre changement dans le ficher README.md

== Git(Hub|Lab|tea|...)

- Un d√©p√¥t distant peut √™tre h√©berg√© par n'importe quel serveur sans besoin autre qu'un acc√®s SSH ou HTTPS.

- Une multitudes de services facilitent et enrichissent encore git: (GitHub, Gitlab, Gitea, Bitbucket...)


== Checkpoint üéØ

=> git + Git(Hub|Lab|tea|...) = superpowers ! ü¶Ñ

* GUI de navigation dans le code
* Plateforme de gestion et suivi d'issues
* Plateforme de revue de code
* Integration aux moteurs de CI/CD
* And so much more...
